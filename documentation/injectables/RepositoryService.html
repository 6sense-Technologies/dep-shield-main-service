<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>ds-backend-prototype documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">ds-backend-prototype documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >RepositoryService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/modules/repository/repository.service.ts</code>
        </p>





            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#formatDependencies" >formatDependencies</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getAllRepos" >getAllRepos</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#getRepositoriesPipeline" >getRepositoriesPipeline</a>
                            </li>
                            <li>
                                <a href="#onModuleInit" >onModuleInit</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#readDependencies" >readDependencies</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#saveDependencies" >saveDependencies</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#selectAll" >selectAll</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#selectedRepos" >selectedRepos</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#selectRepo" >selectRepo</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#selectRepos" >selectRepos</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#watchRepositorySelection" >watchRepositorySelection</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(httpService: HttpService, githubAppService: <a href="../injectables/GithubAppService.html" target="_self">GithubAppService</a>, dependencyService: <a href="../injectables/DependenciesService.html" target="_self">DependenciesService</a>, userModel: <a href="../classes/User.html" target="_self">Model&lt;UserDocument&gt;</a>, RepositoryModel: <a href="../classes/Repository.html" target="_self">Model&lt;RepositoryDocument&gt;</a>, GithubAppModel: <a href="../classes/GithubApp.html" target="_self">Model&lt;GithubAppDocument&gt;</a>, DependencyRepositoryModel: Model<DependencyRepositoryDocument>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="28" class="link-to-prism">src/modules/repository/repository.service.ts:28</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>httpService</td>
                                                  
                                                        <td>
                                                                    <code>HttpService</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>githubAppService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/GithubAppService.html" target="_self" >GithubAppService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>dependencyService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/DependenciesService.html" target="_self" >DependenciesService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userModel</td>
                                                  
                                                        <td>
                                                                        <code><a href="../classes/User.html" target="_self" >Model&lt;UserDocument&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>RepositoryModel</td>
                                                  
                                                        <td>
                                                                        <code><a href="../classes/Repository.html" target="_self" >Model&lt;RepositoryDocument&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>GithubAppModel</td>
                                                  
                                                        <td>
                                                                        <code><a href="../classes/GithubApp.html" target="_self" >Model&lt;GithubAppDocument&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>DependencyRepositoryModel</td>
                                                  
                                                        <td>
                                                                    <code>Model&lt;DependencyRepositoryDocument&gt;</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="formatDependencies"></a>
                    <span class="name">
                        <span ><b>formatDependencies</b></span>
                        <a href="#formatDependencies"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>formatDependencies(dependencies: Record<string | string>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="330"
                                    class="link-to-prism">src/modules/repository/repository.service.ts:330</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>dependencies</td>
                                            <td>
                                                        <code>Record&lt;string | string&gt;</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getAllRepos"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getAllRepos</b></span>
                        <a href="#getAllRepos"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getAllRepos(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, page: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, limit: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="142"
                                    class="link-to-prism">src/modules/repository/repository.service.ts:142</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>userId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>page</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>1</code>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>limit</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>10</code>
                                            </td>

                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getRepositoriesPipeline"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>getRepositoriesPipeline</b></span>
                        <a href="#getRepositoriesPipeline"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getRepositoriesPipeline(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, skipVal: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, limit: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, onlySelected: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank">boolean</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="90"
                                    class="link-to-prism">src/modules/repository/repository.service.ts:90</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>userId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>skipVal</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>limit</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>onlySelected</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>false</code>
                                            </td>

                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>{}</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="onModuleInit"></a>
                    <span class="name">
                        <span ><b>onModuleInit</b></span>
                        <a href="#onModuleInit"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>onModuleInit()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="41"
                                    class="link-to-prism">src/modules/repository/repository.service.ts:41</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="readDependencies"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>readDependencies</b></span>
                        <a href="#readDependencies"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>readDependencies(repoId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="408"
                                    class="link-to-prism">src/modules/repository/repository.service.ts:408</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>repoId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>userId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="saveDependencies"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>saveDependencies</b></span>
                        <a href="#saveDependencies"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>saveDependencies(repoId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="339"
                                    class="link-to-prism">src/modules/repository/repository.service.ts:339</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>repoId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>userId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="selectAll"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>selectAll</b></span>
                        <a href="#selectAll"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>selectAll(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="321"
                                    class="link-to-prism">src/modules/repository/repository.service.ts:321</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>userId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="selectedRepos"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>selectedRepos</b></span>
                        <a href="#selectedRepos"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>selectedRepos(page: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, limit: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="293"
                                    class="link-to-prism">src/modules/repository/repository.service.ts:293</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>page</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>1</code>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>limit</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>10</code>
                                            </td>

                                        </tr>
                                        <tr>
                                                <td>userId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="selectRepo"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>selectRepo</b></span>
                        <a href="#selectRepo"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>selectRepo(urlId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="274"
                                    class="link-to-prism">src/modules/repository/repository.service.ts:274</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>urlId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="selectRepos"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>selectRepos</b></span>
                        <a href="#selectRepos"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>selectRepos(urlIds: string[])</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="245"
                                    class="link-to-prism">src/modules/repository/repository.service.ts:245</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>urlIds</td>
                                            <td>
                                                        <code>string[]</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="watchRepositorySelection"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>watchRepositorySelection</b></span>
                        <a href="#watchRepositorySelection"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>watchRepositorySelection()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="44"
                                    class="link-to-prism">src/modules/repository/repository.service.ts:44</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {
  BadRequestException,
  Injectable,
  NotFoundException,
  UnauthorizedException,
} from &#x27;@nestjs/common&#x27;;
import { HttpService } from &#x27;@nestjs/axios&#x27;;
import { firstValueFrom } from &#x27;rxjs&#x27;;
import { User, UserDocument } from &#x27;../../database/user-schema/user.schema&#x27;;
import { Model, Types } from &#x27;mongoose&#x27;;
import { InjectModel } from &#x27;@nestjs/mongoose&#x27;;
import {
  Repository,
  RepositoryDocument,
} from &#x27;../../database/repository-schema/repository.schema&#x27;;
import {
  GithubApp,
  GithubAppDocument,
} from &#x27;../../database/githubapp-schema/github-app.schema&#x27;;
import { GithubAppService } from &#x27;../github-app/github-app.service&#x27;;
import { validatePagination } from &#x27;./validator/pagination.validator&#x27;;
import {
  DependencyRepository,
  DependencyRepositoryDocument,
} from &#x27;src/database/dependency-repository-schema/dependency-repository.schema&#x27;;
import { DependenciesService } from &#x27;../dependencies/dependencies.service&#x27;;
@Injectable()
export class RepositoryService {
  constructor(
    private readonly httpService: HttpService,
    private readonly githubAppService: GithubAppService,
    private readonly dependencyService: DependenciesService,
    @InjectModel(User.name) private userModel: Model&lt;UserDocument&gt;,
    @InjectModel(Repository.name)
    private RepositoryModel: Model&lt;RepositoryDocument&gt;,
    @InjectModel(GithubApp.name)
    private GithubAppModel: Model&lt;GithubAppDocument&gt;,
    @InjectModel(DependencyRepository.name)
    private DependencyRepositoryModel: Model&lt;DependencyRepositoryDocument&gt;,
  ) {}
  onModuleInit() {
    this.watchRepositorySelection(); // listent to db changes
  }
  private watchRepositorySelection() {
    const changeStream &#x3D; this.RepositoryModel.watch([
      {
        $match: {
          operationType: &#x27;update&#x27;,
          &#x27;updateDescription.updatedFields.isSelected&#x27;: true, // listen to db changes when isSelected is equal to true
        },
      },
    ]);

    changeStream.on(&#x27;change&#x27;, async (change) &#x3D;&gt; {
      console.log(change);

      const { documentKey, updateDescription } &#x3D; change;
      console.log(
        &#x60;Repository ID: ${documentKey._id}, isSelected: ${updateDescription.updatedFields.isSelected}&#x60;,
      );

      // Extract repository ID
      const repoId &#x3D; documentKey._id.toString();

      try {
        // Fetch the full repository document
        const repository &#x3D; await this.RepositoryModel.findOne({
          _id: new Types.ObjectId(repoId),
        })
          .populate(&#x27;user&#x27;) // Optionally populate user and other references
          .exec();

        if (repository) {
          await this.saveDependencies(
            repository._id.toString(),
            repository.user[&#x27;_id&#x27;].toString(),
          );
        } else {
          console.log(&#x27;Repository not found&#x27;);
        }
      } catch (error) {
        console.error(&#x27;Error fetching repository:&#x27;, error);
      }
    });

    changeStream.on(&#x27;error&#x27;, (error) &#x3D;&gt; {
      console.error(&#x27;Change Stream Error:&#x27;, error);
    });
  }
  private getRepositoriesPipeline(
    userId: string,
    skipVal: number,
    limit: number,
    onlySelected: boolean &#x3D; false,
  ) {
    const matchConditions: any &#x3D; {
      user: new Types.ObjectId(userId),
      isDeleted: false,
    };

    if (onlySelected) {
      matchConditions.isSelected &#x3D; true;
    }

    return [
      { $match: matchConditions },
      {
        $lookup: {
          from: &#x27;githubapps&#x27;,
          localField: &#x27;githubApp&#x27;,
          foreignField: &#x27;_id&#x27;,
          as: &#x27;githubApp&#x27;,
        },
      },
      {
        $unwind: {
          path: &#x27;$githubApp&#x27;,
          preserveNullAndEmptyArrays: false,
        },
      },
      {
        $match: {
          &#x27;githubApp.isDeleted&#x27;: false,
        },
      },
      {
        $facet: {
          repositories: [
            { $skip: skipVal },
            { $limit: limit },
            {
              $project: {
                githubApp: 0,
              },
            },
          ],
          totalCount: [{ $count: &#x27;count&#x27; }],
        },
      },
    ];
  }
  async getAllRepos(userId: string, page &#x3D; 1, limit &#x3D; 10) {
    const user &#x3D; await this.userModel.findById(userId).exec();
    const { pageNum, limitNum } &#x3D; validatePagination(page, limit);

    const skipVal &#x3D; (pageNum - 1) * limitNum;
    if (!user) {
      throw new UnauthorizedException(&#x27;User is not valid&#x27;);
    }

    const githubApps &#x3D; await this.GithubAppModel.find({
      user: user,
      isDeleted: false,
    });

    if (githubApps.length &#x3D;&#x3D;&#x3D; 0) {
      throw new BadRequestException(&#x27;No GitHub app is installed&#x27;);
    }

    try {
      const bulkOps &#x3D; [];

      for (let i &#x3D; 0; i &lt; githubApps.length; i +&#x3D; 1) {
        try {
          const token &#x3D; await this.githubAppService.createInstallationToken(
            githubApps[i].installationId,
          );
          console.log(&#x60;Querying API with access token: ${token}&#x60;);

          const response &#x3D; await firstValueFrom(
            this.httpService.get(
              &#x27;https://api.github.com/installation/repositories&#x27;,
              {
                headers: {
                  Authorization: &#x60;Bearer ${token}&#x60;,
                  Accept: &#x27;application/vnd.github.v3+json&#x27;,
                },
                params: {
                  visibility: &#x27;all&#x27;,
                  affiliation: &#x27;owner,collaborator,organization_member&#x27;,
                  per_page: 100, // Maximum number of repos per page
                },
              },
            ),
          );

          // console.log(response.data.repositories[0]);

          for (const repo of response.data.repositories) {
            bulkOps.push({
              updateOne: {
                filter: {
                  user: user.id,
                  repoUrl: repo.url,
                }, // Match by user.id and repoUrl
                update: {
                  $set: {
                    user,
                    repoName: repo.full_name,
                    repoUrl: repo.url,
                    htmlUrl: repo.html_url,
                    repoDescription: repo.description,
                    owner: repo.owner.login,
                    ownerType: repo.owner.type,
                    isPrivate: repo.private,
                    defaultBranch: repo.default_branch,
                    githubApp: githubApps[i],
                    isDeleted: false,
                  },
                },
                upsert: true, // Insert if not found
              },
            });
          }
        } catch (error) {
          console.error(
            &#x60;Error fetching repositories for installation ${githubApps[i].installationId}:&#x60;,
            error.message,
          );
          continue; // Skip to the next GitHub App
        }
      }

      if (bulkOps.length &gt; 0) {
        await this.RepositoryModel.bulkWrite(bulkOps);
      }
      const pipeline &#x3D; this.getRepositoriesPipeline(userId, skipVal, limitNum);
      const repositories &#x3D; await this.RepositoryModel.aggregate(pipeline);

      const repositoriesResult &#x3D; repositories[0].repositories;
      const totalCountResult &#x3D;
        repositories[0].totalCount.length &gt; 0
          ? repositories[0].totalCount[0].count
          : 0;

      return {
        repositories: repositoriesResult,
        totalCount: totalCountResult,
      };
    } catch (error) {
      console.error(&#x27;Unexpected error in getAllRepos:&#x27;, error.message);
    }
  }

  async selectRepos(urlIds: string[]) {
    // Find matching repositories
    const matchedRepos &#x3D; await this.RepositoryModel.find(
      {
        _id: { $in: urlIds },
        isDeleted: false,
      },
      { _id: 1 },
    );

    // Extract matched IDs
    const matchedIds &#x3D; matchedRepos.map((repo) &#x3D;&gt; repo._id.toString());

    // Check if all urlIds are found
    const notFoundIds &#x3D; urlIds.filter((id) &#x3D;&gt; !matchedIds.includes(id));
    if (notFoundIds.length &gt; 0) {
      throw new NotFoundException(
        &#x60;Repositories not found or deleted: ${notFoundIds.join(&#x27;, &#x27;)}&#x60;,
      );
    }

    // Update the matched repositories
    const updated &#x3D; await this.RepositoryModel.updateMany(
      { _id: { $in: matchedIds } },
      { $set: { isSelected: true } },
    );

    return updated;
  }
  async selectRepo(urlId: string) {
    // Find the repository by ID and ensure it&#x27;s not deleted
    const repo &#x3D; await this.RepositoryModel.findOne(
      { _id: urlId, isDeleted: false },
      { _id: 1 },
    );

    // If the repository is not found, throw an error
    if (!repo) {
      throw new NotFoundException(&#x60;Repository not found or deleted: ${urlId}&#x60;);
    }

    // Update the repository to mark it as selected
    return await this.RepositoryModel.updateOne(
      { _id: urlId },
      { $set: { isSelected: true } },
    );
  }

  async selectedRepos(page &#x3D; 1, limit &#x3D; 10, userId: string) {
    const user &#x3D; await this.userModel.findById(userId).exec();
    const { pageNum, limitNum } &#x3D; validatePagination(page, limit);
    const skipVal &#x3D; (pageNum - 1) * limitNum;

    if (!user) {
      throw new UnauthorizedException(&#x27;User is not valid&#x27;);
    }

    const pipeline &#x3D; this.getRepositoriesPipeline(
      userId,
      skipVal,
      limitNum,
      true,
    );
    const repositories &#x3D; await this.RepositoryModel.aggregate(pipeline);

    const repositoriesResult &#x3D; repositories[0].repositories;
    const totalCountResult &#x3D;
      repositories[0].totalCount.length &gt; 0
        ? repositories[0].totalCount[0].count
        : 0;

    return {
      repositories: repositoriesResult,
      totalCount: totalCountResult,
    };
  }
  async selectAll(userId: string) {
    const response &#x3D; await this.RepositoryModel.updateMany(
      { user: new Types.ObjectId(userId), isDeleted: false },
      {
        $set: { isSelected: true },
      },
    );
    return response;
  }
  formatDependencies(dependencies: Record&lt;string, string&gt;) {
    return Object.entries(dependencies).map(([pkg, version]) &#x3D;&gt; ({
      package: pkg,
      version:
        typeof version &#x3D;&#x3D;&#x3D; &#x27;string&#x27;
          ? pkg + &#x27;-&#x27; + version.replace(/^[^\d]+/, &#x27;&#x27;)
          : &#x27;&#x27;,
    }));
  }
  async saveDependencies(repoId: string, userId: string) {
    const repository &#x3D; await this.RepositoryModel.findOne({
      _id: new Types.ObjectId(repoId),
      user: new Types.ObjectId(userId),
      isDeleted: false,
    }).populate(&#x27;githubApp&#x27;);

    if (!repository) {
      throw new NotFoundException(&#x27;Repository not found.&#x27;);
    }

    const accessToken &#x3D; await this.githubAppService.createInstallationToken(
      repository.githubApp.installationId,
    );

    try {
      const response &#x3D; await firstValueFrom(
        this.httpService.get(&#x60;${repository.repoUrl}/contents/package.json&#x60;, {
          headers: {
            Authorization: &#x60;Bearer ${accessToken}&#x60;,
            Accept: &#x27;application/vnd.github.v3+json&#x27;,
            &#x27;X-GitHub-Api-Version&#x27;: &#x27;2022-11-28&#x27;,
          },
        }),
      );

      const dependencyFile &#x3D; response.data;
      const dependencyFileContentDecoded &#x3D; atob(dependencyFile.content);
      const dependencyJSON &#x3D; JSON.parse(dependencyFileContentDecoded);
      const allDependencies &#x3D; {
        ...dependencyJSON[&#x27;dependencies&#x27;],
        ...dependencyJSON[&#x27;devDependencies&#x27;],
      };

      // Format dependencies
      const formattedDependencies &#x3D; this.formatDependencies(allDependencies);

      // Get dependency entries in bulk
      const dependencyEntries &#x3D; await Promise.all(
        formattedDependencies.map((dep) &#x3D;&gt;
          this.dependencyService.create({ dependencyName: dep.package }),
        ),
      );

      // Prepare bulk insert operations
      const bulkOps &#x3D; dependencyEntries.map((entry, index) &#x3D;&gt; ({
        updateOne: {
          filter: {
            repositoryId: new Types.ObjectId(repoId),
            dependencyId: entry._id,
          },
          update: {
            $set: { installedVersion: formattedDependencies[index].version },
          },
          upsert: true,
        },
      }));

      // Perform bulk insert/update
      if (bulkOps.length &gt; 0) {
        await this.DependencyRepositoryModel.bulkWrite(bulkOps);
      }

      return &#x27;Done&#x27;;
    } catch (error) {
      console.error(error);
      throw new NotFoundException(&#x27;Could not retrieve package.json&#x27;);
    }
  }
  async readDependencies(repoId: string, userId: string) {
    const repository &#x3D; await this.RepositoryModel.findOne({
      _id: new Types.ObjectId(repoId),
      user: new Types.ObjectId(userId),
      isDeleted: false,
    }).populate(&#x27;githubApp&#x27;);
    if (repository) {
      const accessToken &#x3D; await this.githubAppService.createInstallationToken(
        repository.githubApp.installationId,
      );

      try {
        const response &#x3D; await firstValueFrom(
          this.httpService.get(repository.repoUrl + &#x60;/contents/package.json&#x60;, {
            headers: {
              Authorization: &#x60;Bearer ${accessToken}&#x60;,
              Accept: &#x27;application/vnd.github.v3+json&#x27;,
              &#x27;X-GitHub-Api-Version&#x27;: &#x27;2022-11-28&#x27;,
            },
          }),
        ); // files can be listed using repository.repoUrl/contents/

        const dependencyFile &#x3D; response.data;
        const dependencyFileContentDecoded &#x3D; atob(dependencyFile.content);
        return dependencyFileContentDecoded;
      } catch (error) {
        console.log(error);
        throw new NotFoundException(&#x27;Could not retrieve repository listing&#x27;);
      }
    } else {
      throw new NotFoundException(&#x27;Repository not found.&#x27;);
    }
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'RepositoryService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
